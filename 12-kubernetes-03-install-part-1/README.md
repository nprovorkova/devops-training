### 12.3 Развертывание кластера на собственных серверах, лекция 1 - Наталия Проворкова
#### 1. Описать требования к кластеру
```
Сначала проекту необходимо определить требуемые ресурсы. Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
Кэш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий.
Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.
```
###### 1. Расчет необходимых ресурсов для проекта.
|             | CPU                          | ОЗУ                               |
|:---         |:---                          |:---                               |
| БД          | 1 * 3 = 3 ядра               | 4 * 3 = 12 Гб                     |     
| Кэш         | 1 * 3 = 3 ядра               | 4 * 3 = 12 Гб                     | 
| Фронтенд    | 0,2 * 5 = 1 ядро             | 0,05 * 5 = 0,25 Гб                | 
| Бэкенд      | 1 * 10 = 10 ядер             | 0,6 * 10 = 6 Гб                   | 
| **Итого**   | **3 + 3 + 1 + 10 = 17 ядер** | **12 + 12 + 0,25 + 6 = 31 Гб** | 
<br>Отсутствует информация по требованиям к дисковому пространству, поэтому будем считать, что у Бизнеса есть большие дисковые мощности, которых будет достаточно для любого числа нод.
###### 2. Выберем число рабочих нод для распределения нагрузки.
Предлагаю сделать расчеты для 3, 4 и 5 рабочих нод, чтобы Бизнес мог принять решение в пользу отказоустойчивости или в пользу экономии. Делать меньше трех нод считаю слишком рискованным, а более 5 - не целесообразным.
<br>В целях отказоустойчивости предлагаю выделить три Control Plane ноды, так как число мастер-нод должно быть нечетным.
<br>Рассчитаем ресурсы c учетом обязательного для ПО ноды:
<br>Control Plane-nodes:
|       | 3 Control Plane-nodes | 
|:---   |:---                   |
| CPU   | 2 * 3 = 6 ядер        | 
| ОЗУ   | 2 * 3 = 6 ГБ          |
<br>Worker-nodes:
|       | 3 Worker-nodes   | 4 Worker-nodes   | 5 Worker-nodes   |
|:---   |:---              |:---              | :---             |
| CPU   | 17 + 3 = 20 ядер | 17 + 4 = 21 ядро | 17 + 5 = 22 ядра |    
| ОЗУ   | 31 + 3 = 34 Гб   | 31 + 4 = 35 Гб   | 31 + 5 = 36 Гб   |
###### 3. Добавим к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды. С учетом служебных ресурсов ноды
|       | 3 Worker-nodes            | 4 Worker-nodes            | 5 Worker-nodes           |
|:---   |:---                       |:---                       | :---                     |
| CPU   | (17 * 1,33) + 3 = 26 ядер | (17 * 1,25) + 4 = 26 ядер | (17 * 1,2) + 5 = 26 ядер |    
| ОЗУ   | (31 * 1,33) + 3 = 45 Гб   | (31 * 1,25) + 4 = 43 Гб   | (31 * 1,2) + 5 = 43 Гб   |
###### 5. Рассчитайте итоговые цифры.
Считаем требования к ресурсам на каждую Worker-ноду:
|       | 3 Worker-nodes  | 4 Worker-nodes  | 5 Worker-nodes  |
|:---   |:---             |:---             | :---            |
| CPU   | 26 / 3 = 9 ядер | 26 / 7 = 7 ядер | 26 / 5 = 6 ядер |    
| ОЗУ   | 45 / 3 - 15 Гб  | 43 / 4 = 11 Гб  | 43 / 5 = 9 Гб   |
###### 6. В результате должно быть указано количество нод и их параметры.
Предлагаю выделить 3 Control Plane-ноды по 2 ядра и 2 Гб на каждую
<br>Так как расчеты с учетом отказоустойчивости привели к тому, что общее число требуемого CPU и ОЗУ практически одинаковы для 3,4 и 5 нод, то предлагаю использовать 5 рабочих нод.
<br>Предлагаю выделить 5 Worker-нод по 6 ядер и 9 Гб на каждую
<br>Общее число требуемых ресурсов: 36 CPU и 51 Гб ОЗУ